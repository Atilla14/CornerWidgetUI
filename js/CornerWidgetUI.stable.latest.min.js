/************************************************
 *  Lucep's CornerWidgetUI - An extension to the 
 *  Lucep service that provides an inbound lead form
 *  for websites (free for commercial or non-commercial use)
 *  https://github.com/lucep/CornerWidgetUI
 * 
 *  Copyright (C) 2015 Lucep Pte Ltd 
 *  Contributors: 
 *    - Kaiesh Vohra (@kaiesh - https://github.com/kaiesh)
 *
 *  This program is free software: you can redistribute it and/or modify
 *  it under the terms of the GNU General Public License as published by
 *  the Free Software Foundation, either version 3 of the License, or
 *  (at your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License
 *  along with this program.  If not, see <http://www.gnu.org/licenses/>.
 *
 *************************************************/
CornerWidgetUI={constants:{WIDGET_CSS:"https://8d69a4badb4c0e3cd487-efd95a2de0a33cb5b6fcd4ec94d1740c.ssl.cf2.rackcdn.com/css/CornerWidgetUI.stable.latest.min.css",SESSION_WINDOW:9E5,_uivar_widgetID:"gorillaWidget",_uivar_barID:"gorillaBar",_uivar_barTxtID:"gorillaBarTxt",_uivar_boxID:"gorillaBox",_uivar_pulseID:"gorillaPulse",_uivar_formdataID:"gorillaForm",_uivar_leadnameID:"gorillaFormName",_uivar_leadtelID:"gorillaFormTel",_uivar_leadserviceID:"gorillaFormService",_uivar_sendleadID:"gorillaFormContact",
_uivar_formlabelID:"gorillaLabel"},menu_tree:function(b,a){for(var c="",d=0;d<b.length;d++)c="[object Array]"===Object.prototype.toString.call(b[d].children)?c+L.SalesGorilla.UI.menu_tree(b[d].children,a):c+("<option value='"+b[d].service_id+"'>"+b[d].lt[a]+"</option>");return c},init:function(b){$lucep.get_kiosk_details({callback:function(a){CornerWidgetUI._ui_config=a;CornerWidgetUI._ui_config.default_lang=a.default_lang?a.default_lang:"eng";CornerWidgetUI._ui_config.closed_txt=a.closed_txt?a.closed_txt:
{eng:"Click here to get a callback"};CornerWidgetUI._ui_config.open_txt=a.open_txt?a.open_txt:{eng:"Please tell us how to contact you, and we'll give you a call back now"};CornerWidgetUI._ui_config.extra_fields=a.extra_fields?a.extra_fields:{};CornerWidgetUI._ui_config.colour=a.color?a.color:{background:"#4067CB"};CornerWidgetUI._ui_config.url=b.url?a.url:"default";CornerWidgetUI._ui_config.kiosk_id=b.id?b.id:"1";CornerWidgetUI._ui_config.button_cta=b.button_cta?b.button_cta:{eng:"Call me!"};CornerWidgetUI._ui_config.validation=
{limit:b.validation_limit?b.validation_limit:1,count:0};CornerWidgetUI._ui_config.tel_input_prefs={defaultCountry:"auto",nationalMode:!0,preferredCountries:a.default_countries?a.default_countries:["us","gb","sg"],responsiveDropdown:!0,utilsScript:"https://8d69a4badb4c0e3cd487-efd95a2de0a33cb5b6fcd4ec94d1740c.ssl.cf2.rackcdn.com/js/telutils.js",geoIpLookup:function(a){$lucep.get_geo_data({callback:function(b){a(b&&b.country?b.country:"")}})}};CornerWidgetUI._ui_config.menutree=CornerWidgetUI.menu_tree(a.menu.tree.children,
CornerWidgetUI._ui_config.default_lang);a=document.createElement("DIV");a.id=CornerWidgetUI.constants._uivar_widgetID;var c=document.createElement("DIV");c.id=CornerWidgetUI.constants._uivar_barID;c.className="a-gorilla-loading";CornerWidgetUI._within_session()?a.className="":a.className="a-gorilla-loading";var d=document.createElement("DIV");d.id=CornerWidgetUI.constants._uivar_boxID;var e=document.createElement("DIV");e.id=CornerWidgetUI.constants._uivar_pulseID;null!=document.body&&(document.body.appendChild(a),
document.body.appendChild(c),document.body.appendChild(d),document.body.appendChild(e));CornerWidgetUI.elem_widget_btn=document.getElementById(CornerWidgetUI.constants._uivar_widgetID);CornerWidgetUI.elem_widget_bar=document.getElementById(CornerWidgetUI.constants._uivar_barID);CornerWidgetUI.elem_widget_box=document.getElementById(CornerWidgetUI.constants._uivar_boxID);CornerWidgetUI.elem_pulse=document.getElementById(CornerWidgetUI.constants._uivar_pulseID);a=document.createElement("link");a.rel=
"stylesheet";a.media="screen";a.type="text/css";a.href=CornerWidgetUI.constants.WIDGET_CSS;a.onload=function(){CornerWidgetUI._load_libraries(b);CornerWidgetUI._draw_ui(b);CornerWidgetUI._bind_events(b);CornerWidgetUI.control({state:"new"})};CornerWidgetUI._attach_css(a)}})},_within_session:function(b){var a=!1;$lucep.get_data({key:"gorilla-last-launch"})&&$lucep.get_data({key:"gorilla-last-launch"})+CornerWidgetUI.constants.SESSION_WINDOW>(new Date).getTime()&&(a=!0);b&&$lucep.put_data({key:"gorilla-last-launch",
value:(new Date).getTime()});return a},_attach_css:function(b){null!=document.body?document.body.appendChild(b):setTimeout(function(){CornerWidgetUI._attach_css(b)},250)},_load_libraries:function(b){var a=b.jquery?b.jquery:"https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js",c=b.intlTelInput_js?b.intlTelInput_js:"https://8d69a4badb4c0e3cd487-efd95a2de0a33cb5b6fcd4ec94d1740c.ssl.cf2.rackcdn.com/js/intlTelInput.js",d=b.intlTelInput_css?b.intlTelInput_css:"https://8d69a4badb4c0e3cd487-efd95a2de0a33cb5b6fcd4ec94d1740c.ssl.cf2.rackcdn.com/css/intlTelInput.css",
e=function(a){$lucep.add({src:c},function(){0<jQuery("#gorillaFormTel").length&&(jQuery("#"+CornerWidgetUI.constants._uivar_leadtelID).intlTelInput(CornerWidgetUI._ui_config.tel_input_prefs),CornerWidgetUI._f_set=!0)},"head","script",0)},f=function(a){$lucep.add({href:d,rel:"stylesheet",type:"text/css"},function(){e(a)},"body","link",0)};window.jQuery?f(params):$lucep.add({src:a},function(){f(b)},"head","script",0)},_declare_bar_length:function(){CornerWidgetUI._cssLoad?(CornerWidgetUI._bar_length||
(CornerWidgetUI._bar_length=document.getElementById(CornerWidgetUI.constants._uivar_barTxtID).clientWidth),CornerWidgetUI._manage_styles({elem:document.getElementById(CornerWidgetUI.constants._uivar_barID),style:{width:CornerWidgetUI._bar_length+"px"}})):CornerWidgetUI._cssLoad=!0},_draw_ui:function(){setTimeout(function(){CornerWidgetUI._declare_bar_length()},1500);var b=document.createElement("DIV");b.id=CornerWidgetUI.constants._uivar_formdataID;CornerWidgetUI.elem_widget_box.appendChild(b);var a=
b="";$lucep.get_data({key:"name"})&&(b=$lucep.get_data({key:"name"}));$lucep.get_data({key:"tel"})&&(a=$lucep.get_data({key:"tel"}));var c=document.getElementById(CornerWidgetUI.constants._uivar_formdataID);c.innerHTML=CornerWidgetUI._ui_config.open_txt[CornerWidgetUI._ui_config.default_lang]+"<input type='text' id='"+CornerWidgetUI.constants._uivar_leadnameID+"' placeholder ='Your Name' value='"+b+"' /><input type='tel' id='"+CornerWidgetUI.constants._uivar_leadtelID+"'/><select id='"+CornerWidgetUI.constants._uivar_leadserviceID+
"'>"+CornerWidgetUI._ui_config.menutree+"</select><button id='"+CornerWidgetUI.constants._uivar_sendleadID+"'>Call me!</button><span id='"+CornerWidgetUI.constants._uivar_formlabelID+"' ><a href='https://www.lucep.com/?ref="+document.URL+"&s="+CornerWidgetUI._ui_config.url+"&k="+CornerWidgetUI._ui_config.kiosk_id+"&l="+CornerWidgetUI._ui_config.default_lang+"' target='_blank' >Powered by Lucep</a></span>";CornerWidgetUI.elem_formdata=c;CornerWidgetUI.elem_widget_bar.innerHTML="<span id='gorillaBarTxt'>"+
CornerWidgetUI._ui_config.closed_txt[CornerWidgetUI._ui_config.default_lang]+"</span>";""!=a&&(document.getElementById(CornerWidgetUI.constants._uivar_leadtelID).value=a)},_bind_events:function(b){window.jQuery&&jQuery().intlTelInput&&!CornerWidgetUI._f_set&&(jQuery("#"+CornerWidgetUI.constants._uivar_leadtelID).intlTelInput(CornerWidgetUI._ui_config.tel_input_prefs),CornerWidgetUI._f_set=!0);CornerWidgetUI.elem_widget_btn.addEventListener("click",function(a){a=a||window.event;window.intlTelInputUtils||
jQuery("#"+CornerWidgetUI.constants._uivar_leadtelID).intlTelInput("loadUtils",CornerWidgetUI._ui_config.tel_input_prefs.utilsScript);CornerWidgetUI.control({state:"clicked_icon",event:a,elem:this})});CornerWidgetUI.elem_widget_bar.addEventListener("click",function(a){a=a||window.event;window.intlTelInputUtils||jQuery("#"+CornerWidgetUI.constants._uivar_leadtelID).intlTelInput("loadUtils",CornerWidgetUI._ui_config.tel_input_prefs.utilsScript);CornerWidgetUI.control({state:"clicked_icon",event:a,elem:this})});
CornerWidgetUI.elem_sendlead_btn=document.getElementById(CornerWidgetUI.constants._uivar_sendleadID);CornerWidgetUI.elem_field_name=document.getElementById(CornerWidgetUI.constants._uivar_leadnameID);CornerWidgetUI.elem_field_tel=document.getElementById(CornerWidgetUI.constants._uivar_leadtelID);CornerWidgetUI.elem_field_service=document.getElementById(CornerWidgetUI.constants._uivar_leadserviceID);CornerWidgetUI.elem_field_tel.addEventListener("change",function(a){window.intlTelInputUtils||jQuery("#"+
CornerWidgetUI.constants._uivar_leadtelID).intlTelInput("loadUtils",CornerWidgetUI._ui_config.tel_input_prefs.utilsScript)});CornerWidgetUI.elem_sendlead_btn.addEventListener("click",function(a){CornerWidgetUI._raise_lead(this)})},_manage_styles:function(b){if(b.reset){for(var a="",c=0;c<b.reset.length;c++)""!=a&&(a+=";"),a+=b.reset[c]+":''",b.elem.style[b.reset[c]]="";b.elem.setAttribute("style",a)}if(b.style){var a="",d;for(d in b.style)b.style.hasOwnProperty(d)&&(""!=a&&(a+=";"),a+=d+":"+b.style[d],
b.elem.style[d]=b.style[d]);b.elem.setAttribute("style",a)}b.elem.className=b.className?b.className:""},control:function(b){switch(b.state){case "raised_lead":CornerWidgetUI._manage_styles({elem:CornerWidgetUI.elem_widget_btn,reset:["bottom","right"],className:"a-gorilla-aboutToWait"});CornerWidgetUI._manage_styles({elem:CornerWidgetUI.elem_widget_box,reset:"height"});CornerWidgetUI._manage_styles({elem:CornerWidgetUI.elem_widget_bar});CornerWidgetUI._declare_bar_length();CornerWidgetUI.elem_sendlead_btn.innerHTML=
"Waiting for callback";setTimeout(function(){CornerWidgetUI.elem_widget_btn.className="a-gorilla-waiting"},1100);"raised_lead"!=CornerWidgetUI._prev_state&&(CornerWidgetUI.elem_field_name.disabled=!0,CornerWidgetUI.elem_field_tel.disabled=!0,CornerWidgetUI.elem_field_service.disabled=!0,CornerWidgetUI.elem_sendlead_btn.disabled=!0,$lucep.send_intelligence({event_type:"raised-lead",payload:{country:window.jQuery(".selected-flag").attr("title")}}));CornerWidgetUI._prev_state=CornerWidgetUI._curr_state;
CornerWidgetUI._curr_state="raised_lead";break;case "tapped_icon":case "clicked_icon":"a-gorilla-clicked"==CornerWidgetUI.elem_widget_btn.className?(CornerWidgetUI._manage_styles({elem:CornerWidgetUI.elem_widget_btn,reset:["bottom","right"]}),CornerWidgetUI._manage_styles({elem:CornerWidgetUI.elem_widget_box,reset:["height"]}),CornerWidgetUI._manage_styles({elem:CornerWidgetUI.elem_widget_bar,reset:["right","bottom"]}),CornerWidgetUI._declare_bar_length(),"new"==CornerWidgetUI._prev_state||"closed"==
CornerWidgetUI._prev_state||"open"==CornerWidgetUI._prev_state?(CornerWidgetUI.elem_widget_btn.className="",CornerWidgetUI.elem_widget_box.className="",CornerWidgetUI.elem_widget_bar.className="",CornerWidgetUI._prev_state=CornerWidgetUI._curr_state,CornerWidgetUI._curr_state="closed"):"in_call"==CornerWidgetUI._prev_state?(CornerWidgetUI.elem_widget_btn.className="a-gorilla-incall",CornerWidgetUI.elem_widget_box.className="",CornerWidgetUI.elem_widget_bar.className="",CornerWidgetUI._prev_state=
CornerWidgetUI._curr_state,CornerWidgetUI._curr_state="in_call"):"raised_lead"==CornerWidgetUI._prev_state&&(CornerWidgetUI.elem_widget_btn.className="a-gorilla-aboutToWait",CornerWidgetUI.elem_widget_box.className="",CornerWidgetUI.elem_widget_bar.className="",CornerWidgetUI.elem_sendlead_btn.innerHTML="Waiting for callback",setTimeout(function(){CornerWidgetUI.elem_widget_btn.className="a-gorilla-waiting"},1100),CornerWidgetUI._prev_state=CornerWidgetUI._curr_state,CornerWidgetUI._curr_state="raised_lead"),
$lucep.send_intelligence({event_type:"close-prompt",customer_ref:window.jQuery(".selected-flag").attr("title")})):(CornerWidgetUI._manage_styles({elem:CornerWidgetUI.elem_widget_btn,style:{bottom:CornerWidgetUI.elem_formdata.clientHeight+13+20+"px",right:CornerWidgetUI.elem_formdata.clientWidth+20+"px"},className:"a-gorilla-clicked"}),CornerWidgetUI._manage_styles({elem:CornerWidgetUI.elem_widget_box,style:{height:CornerWidgetUI.elem_formdata.clientHeight+13+"px",width:CornerWidgetUI.elem_formdata.clientWidth+
"px"},className:"a-gorilla-open"}),CornerWidgetUI._manage_styles({elem:CornerWidgetUI.elem_widget_bar,style:{bottom:CornerWidgetUI.elem_formdata.clientHeight+13+20+10+"px",right:CornerWidgetUI.elem_formdata.clientWidth+20+20+"px"},className:"a-gorilla-open"}),setTimeout(function(){CornerWidgetUI.elem_widget_box.style.overflow="visible"},1E3),$lucep.send_intelligence({event_type:"open-prompt",customer_ref:window.jQuery(".selected-flag").attr("title")}),CornerWidgetUI._prev_state=CornerWidgetUI._curr_state,
CornerWidgetUI._curr_state="open");break;case "in_call":"in_call"!=CornerWidgetUI._curr_state&&"open"!=CornerWidgetUI._curr_state?(CornerWidgetUI.elem_widget_btn.className="a-gorilla-aboutToWait",setTimeout(function(){CornerWidgetUI.elem_widget_btn.className="a-gorilla-incall"},500),CornerWidgetUI._prev_state=CornerWidgetUI._curr_state,CornerWidgetUI._curr_state=b.state):CornerWidgetUI._prev_state="in_call";CornerWidgetUI.elem_field_name.disabled=!0;CornerWidgetUI.elem_field_tel.disabled=!0;CornerWidgetUI.elem_field_service.disabled=
!0;CornerWidgetUI.elem_sendlead_btn.disabled=!0;CornerWidgetUI.elem_sendlead_btn.innerHTML="Currently in call";break;case "new":"undefined"==typeof CornerWidgetUI._prev_state||null==CornerWidgetUI._prev_state?(CornerWidgetUI._within_session(!0)?(CornerWidgetUI.elem_widget_btn.className="",CornerWidgetUI.elem_widget_box.className="",CornerWidgetUI.elem_widget_bar.className="",CornerWidgetUI._declare_bar_length()):setTimeout(function(){CornerWidgetUI.elem_widget_btn.className="";CornerWidgetUI.elem_widget_box.className=
"";CornerWidgetUI._declare_bar_length();CornerWidgetUI.elem_pulse.className="emit";setTimeout(function(){CornerWidgetUI.elem_pulse.className=""},2100)},1E3),CornerWidgetUI._prev_state=b.state,CornerWidgetUI._curr_state=b.state):(CornerWidgetUI._curr_state=b.state,CornerWidgetUI._manage_styles({elem:CornerWidgetUI.elem_widget_btn,reset:["bottom","right"]}),CornerWidgetUI._manage_styles({elem:CornerWidgetUI.elem_widget_box,reset:["height","overflow","width"]}),CornerWidgetUI._manage_styles({elem:CornerWidgetUI.elem_widget_bar,
reset:["bottom","right"]}),CornerWidgetUI._declare_bar_length()),CornerWidgetUI.elem_field_name.disabled=!1,CornerWidgetUI.elem_field_tel.disabled=!1,CornerWidgetUI.elem_field_service.disabled=!1,CornerWidgetUI.elem_sendlead_btn.disabled=!1,CornerWidgetUI.elem_sendlead_btn.innerHTML=CornerWidgetUI._ui_config.button_cta[CornerWidgetUI._ui_config.default_lang]}b.event&&(b.event.stopPropagation?b.event.stopPropagation():b.event.cancelBubble=!0)},_raise_lead:function(b){if(!jQuery("#"+CornerWidgetUI.constants._uivar_leadtelID).intlTelInput("isValidNumber")&&
CornerWidgetUI._ui_config.validation.count<CornerWidgetUI._ui_config.validation.limit)return jQuery("#"+CornerWidgetUI.constants._uivar_leadtelID).addClass("a-gorilla-error"),setTimeout(function(){jQuery("#"+CornerWidgetUI.constants._uivar_leadtelID).removeClass("a-gorilla-error")},1E3),CornerWidgetUI._ui_config.validation.count++,!1;CornerWidgetUI._ui_config.validation.count=0;var a;if(window.intlTelInputUtils&&""!==window.jQuery("#"+CornerWidgetUI.constants._uivar_leadtelID).intlTelInput("getNumber"))a=
window.jQuery("#"+CornerWidgetUI.constants._uivar_leadtelID).intlTelInput("getNumber");else{a=window.jQuery(".selected-flag").attr("title");a=a.substr(a.indexOf(": +")+2,5);var c=window.jQuery("#"+CornerWidgetUI.constants._uivar_leadtelID).val();a=0===c.indexOf(a)?c:a+""+c}$lucep.put_data({key:"name",value:document.getElementById(CornerWidgetUI.constants._uivar_leadnameID).value});$lucep.put_data({key:"tel",value:a});$lucep.raise_lead({payload:{},service_id:document.getElementById(CornerWidgetUI.constants._uivar_leadserviceID).value,
service_name:window.jQuery("#gorillaFormService option:selected").text(),phone_number:a,name:document.getElementById(CornerWidgetUI.constants._uivar_leadnameID).value,callback:function(a){if(a["ticket-status"]||!0!==a.server)switch(a["ticket-status"]){case "new":CornerWidgetUI.control({state:"raised_lead"});break;case "processing":CornerWidgetUI.control({state:"in_call"});break;case "finished":CornerWidgetUI.control({state:"new"});break;case "no-ticket":CornerWidgetUI.control({state:"new"})}else CornerWidgetUI.control({state:"new"})}});
b.disabled=!0;CornerWidgetUI.elem_field_name.disabled=!0;CornerWidgetUI.elem_field_tel.disabled=!0;CornerWidgetUI.elem_field_service.disabled=!0;b.innerHTML="<img src='https://8d69a4badb4c0e3cd487-efd95a2de0a33cb5b6fcd4ec94d1740c.ssl.cf2.rackcdn.com/images/small-spinner.gif' alt='Please wait' />"}};window.$lucep_ui=CornerWidgetUI;
