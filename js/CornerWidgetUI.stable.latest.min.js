/************************************************
 *  Lucep's CornerWidgetUI - An extension to the 
 *  Lucep service that provides an inbound lead form
 *  for websites (free for commercial or non-commercial use)
 *  https://github.com/lucep/CornerWidgetUI
 * 
 *  Copyright (C) 2015 Lucep Pte Ltd 
 *  Contributors: 
 *    - Kaiesh Vohra (@kaiesh - https://github.com/kaiesh)
 *
 *  This program is free software: you can redistribute it and/or modify
 *  it under the terms of the GNU General Public License as published by
 *  the Free Software Foundation, either version 3 of the License, or
 *  (at your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License
 *  along with this program.  If not, see <http://www.gnu.org/licenses/>.
 *
 *************************************************/
CornerWidgetUI={constants:{SESSION_WINDOW:9E5,_uivar_widgetID:"gorillaWidget",_uivar_barID:"gorillaBar",_uivar_barTxtID:"gorillaBarTxt",_uivar_boxID:"gorillaBox",_uivar_pulseID:"gorillaPulse",_uivar_formdataID:"gorillaForm",_uivar_botholder:"gorillaBT",_uivar_kill:"gorillaEnd",_uivar_leadnameID:"gorillaFormName",_uivar_leadtelID:"gorillaFormTel",_uivar_leadserviceID:"gorillaFormService",_uivar_sendleadID:"gorillaFormContact",_uivar_formlabelID:"gorillaLabel",_uivar_controlfield1:"gorillaCtrl1",_uivar_controlfield2:"gorillaCtrl2",
_formval_placeholder2:"gorillaControlVal"},menu_tree:function(a,b){for(var c="",d=0;d<a.length;d++)c="[object Array]"===Object.prototype.toString.call(a[d].children)?c+L.SalesGorilla.UI.menu_tree(a[d].children,b):c+("<option value='"+a[d].service_id+"'>"+a[d].lt[b]+"</option>");return c},_dyn_obj:function(a){for(var b={},c=0;c<a.length;c++)b[a[c].key]=a[c].value;return b},init:function(a){$lucep.get_kiosk_details({callback:function(b){CornerWidgetUI._ui_config=b;CornerWidgetUI._ui_config.default_lang=
b.default_lang?b.default_lang:"eng";CornerWidgetUI._ui_config.closed_txt=b.closed_txt?b.closed_txt:{eng:"Click here to get a callback"};CornerWidgetUI._ui_config.open_txt=b.open_txt?b.open_txt:{eng:"Please tell us how to contact you, and we'll give you a call back now"};CornerWidgetUI._ui_config.extra_fields=b.extra_fields?b.extra_fields:{};CornerWidgetUI._ui_config.colour=b.color?b.color:{background:"#4067CB"};CornerWidgetUI._ui_config.url=a.url?b.url:"default";CornerWidgetUI._ui_config.kiosk_id=
a.id?a.id:"1";CornerWidgetUI._ui_config.button_cta=a.button_cta?a.button_cta:{eng:"Call me!"};CornerWidgetUI._ui_config.validation={limit:a.validation_limit?a.validation_limit:1,count:0};CornerWidgetUI._ui_config.auto_open=a.auto_open?a.auto_open:13E3;CornerWidgetUI._ui_config.position=a.position?a.position:{align:"right","vertical-align":"bottom"};CornerWidgetUI._ui_config.css=a.css?a.css:"https://8d69a4badb4c0e3cd487-efd95a2de0a33cb5b6fcd4ec94d1740c.ssl.cf2.rackcdn.com/css/CornerWidgetUI.stable.latest.min.css";
CornerWidgetUI._ui_config.tel_input_prefs={defaultCountry:"auto",nationalMode:!0,preferredCountries:b.default_countries?b.default_countries:["us","gb","sg"],responsiveDropdown:!0,utilsScript:"https://8d69a4badb4c0e3cd487-efd95a2de0a33cb5b6fcd4ec94d1740c.ssl.cf2.rackcdn.com/js/telutils.js",geoIpLookup:function(a){$lucep.get_geo_data({callback:function(b){a(b&&b.country?b.country:"")}})}};CornerWidgetUI._ui_config.menutree=CornerWidgetUI.menu_tree(b.menu.tree.children,CornerWidgetUI._ui_config.default_lang);
b=document.createElement("DIV");b.id=CornerWidgetUI.constants._uivar_widgetID;var c=document.createElement("DIV");c.id=CornerWidgetUI.constants._uivar_barID;c.className="a-gorilla-loading";CornerWidgetUI._within_session()?b.className="":b.className="a-gorilla-loading";var d=document.createElement("DIV");d.id=CornerWidgetUI.constants._uivar_boxID;var e=document.createElement("DIV");e.id=CornerWidgetUI.constants._uivar_pulseID;null!=document.body&&(document.body.appendChild(b),document.body.appendChild(c),
document.body.appendChild(d),document.body.appendChild(e));CornerWidgetUI.elem_widget_btn=document.getElementById(CornerWidgetUI.constants._uivar_widgetID);CornerWidgetUI.elem_widget_bar=document.getElementById(CornerWidgetUI.constants._uivar_barID);CornerWidgetUI.elem_widget_box=document.getElementById(CornerWidgetUI.constants._uivar_boxID);CornerWidgetUI.elem_pulse=document.getElementById(CornerWidgetUI.constants._uivar_pulseID);b=document.createElement("link");b.rel="stylesheet";b.media="screen";
b.type="text/css";b.href=CornerWidgetUI._ui_config.css;b.onload=function(){CornerWidgetUI._load_libraries(a);CornerWidgetUI._draw_ui(a);CornerWidgetUI._bind_events(a);CornerWidgetUI.control({state:"new"})};CornerWidgetUI._attach_css(b)}})},_within_session:function(a){var b=!1;$lucep.get_data({key:"gorilla-last-launch"})&&$lucep.get_data({key:"gorilla-last-launch"})+CornerWidgetUI.constants.SESSION_WINDOW>(new Date).getTime()&&(b=!0);a&&$lucep.put_data({key:"gorilla-last-launch",value:(new Date).getTime()});
return b},_attach_css:function(a){null!=document.body?document.body.appendChild(a):setTimeout(function(){CornerWidgetUI._attach_css(a)},250)},_load_libraries:function(a){var b=a.jquery?a.jquery:"https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js",c=a.intlTelInput_js?a.intlTelInput_js:"https://8d69a4badb4c0e3cd487-efd95a2de0a33cb5b6fcd4ec94d1740c.ssl.cf2.rackcdn.com/js/intlTelInput.js",d=a.intlTelInput_css?a.intlTelInput_css:"https://8d69a4badb4c0e3cd487-efd95a2de0a33cb5b6fcd4ec94d1740c.ssl.cf2.rackcdn.com/css/intlTelInput.css",
e=function(a){$lucep.add({src:c},function(){0<jQuery("#gorillaFormTel").length&&(jQuery("#"+CornerWidgetUI.constants._uivar_leadtelID).intlTelInput(CornerWidgetUI._ui_config.tel_input_prefs),CornerWidgetUI._f_set=!0)},"head","script",0)},f=function(a){$lucep.add({href:d,rel:"stylesheet",type:"text/css"},function(){e(a)},"body","link",0)};window.jQuery?f(a):$lucep.add({src:b},function(){f(a)},"head","script",0)},_declare_bar_length:function(){CornerWidgetUI._cssLoad?(CornerWidgetUI._bar_length||(CornerWidgetUI._bar_length=
document.getElementById(CornerWidgetUI.constants._uivar_barTxtID).clientWidth),CornerWidgetUI._manage_styles({elem:document.getElementById(CornerWidgetUI.constants._uivar_barID),style:{width:CornerWidgetUI._bar_length+"px"}})):CornerWidgetUI._cssLoad=!0},_draw_ui:function(){setTimeout(function(){CornerWidgetUI._declare_bar_length()},1500);var a=document.createElement("DIV");a.id=CornerWidgetUI.constants._uivar_formdataID;CornerWidgetUI.elem_widget_box.appendChild(a);var b=a="";$lucep.get_data({key:"name"})&&
(a=$lucep.get_data({key:"name"}));$lucep.get_data({key:"tel"})&&(b=$lucep.get_data({key:"tel"}));var c=document.getElementById(CornerWidgetUI.constants._uivar_formdataID);c.innerHTML=CornerWidgetUI._ui_config.open_txt[CornerWidgetUI._ui_config.default_lang]+"<input type='text' id='"+CornerWidgetUI.constants._uivar_leadnameID+"' placeholder ='Your Name' value='"+a+"' /><input type='tel' id='"+CornerWidgetUI.constants._uivar_leadtelID+"'/><select id='"+CornerWidgetUI.constants._uivar_leadserviceID+
"'>"+CornerWidgetUI._ui_config.menutree+"</select><div id='"+CornerWidgetUI.constants._uivar_botholder+"'><input type='text' id='"+CornerWidgetUI.constants._uivar_controlfield1+"' placeholder='Your input' /><input type='text' id='"+CornerWidgetUI.constants._uivar_controlfield2+"' placeholder='Your input' value='"+CornerWidgetUI.constants._formval_placeholder2+"' /><button id='"+CornerWidgetUI.constants._uivar_kill+"'>Done</button></div><button id='"+CornerWidgetUI.constants._uivar_sendleadID+"'>Call me!</button><span id='"+
CornerWidgetUI.constants._uivar_formlabelID+"' ><a href='https://www.lucep.com/?ref="+document.URL+"&s="+CornerWidgetUI._ui_config.url+"&k="+CornerWidgetUI._ui_config.kiosk_id+"&l="+CornerWidgetUI._ui_config.default_lang+"' target='_blank' >Powered by Lucep</a></span>";CornerWidgetUI.elem_formdata=c;CornerWidgetUI.elem_widget_bar.innerHTML="<span id='gorillaBarTxt'>"+CornerWidgetUI._ui_config.closed_txt[CornerWidgetUI._ui_config.default_lang]+"</span>";""!=b&&(document.getElementById(CornerWidgetUI.constants._uivar_leadtelID).value=
b)},_bind_events:function(a){window.jQuery&&jQuery().intlTelInput&&!CornerWidgetUI._f_set&&(jQuery("#"+CornerWidgetUI.constants._uivar_leadtelID).intlTelInput(CornerWidgetUI._ui_config.tel_input_prefs),CornerWidgetUI._f_set=!0);document.getElementById(CornerWidgetUI.constants._uivar_kill).addEventListener("click",function(a){CornerWidgetUI._block=!0});CornerWidgetUI.elem_widget_btn.addEventListener("click",function(a){a=a||window.event;window.intlTelInputUtils||jQuery("#"+CornerWidgetUI.constants._uivar_leadtelID).intlTelInput("loadUtils",
CornerWidgetUI._ui_config.tel_input_prefs.utilsScript);CornerWidgetUI.control({state:"clicked_icon",event:a,elem:this})});CornerWidgetUI.elem_widget_bar.addEventListener("click",function(a){a=a||window.event;window.intlTelInputUtils||jQuery("#"+CornerWidgetUI.constants._uivar_leadtelID).intlTelInput("loadUtils",CornerWidgetUI._ui_config.tel_input_prefs.utilsScript);CornerWidgetUI.control({state:"clicked_icon",event:a,elem:this})});CornerWidgetUI.elem_sendlead_btn=document.getElementById(CornerWidgetUI.constants._uivar_sendleadID);
CornerWidgetUI.elem_field_name=document.getElementById(CornerWidgetUI.constants._uivar_leadnameID);CornerWidgetUI.elem_field_tel=document.getElementById(CornerWidgetUI.constants._uivar_leadtelID);CornerWidgetUI.elem_field_service=document.getElementById(CornerWidgetUI.constants._uivar_leadserviceID);CornerWidgetUI.elem_field_tel.addEventListener("change",function(a){window.intlTelInputUtils||jQuery("#"+CornerWidgetUI.constants._uivar_leadtelID).intlTelInput("loadUtils",CornerWidgetUI._ui_config.tel_input_prefs.utilsScript)});
CornerWidgetUI.elem_sendlead_btn.addEventListener("click",function(a){CornerWidgetUI._raise_lead(this)})},_manage_styles:function(a){if(a.reset){for(var b="",c=0;c<a.reset.length;c++)""!=b&&(b+=";"),b+=a.reset[c]+":''",a.elem.style[a.reset[c]]="";a.elem.setAttribute("style",b)}if(a.style){var b="",d;for(d in a.style)a.style.hasOwnProperty(d)&&(""!=b&&(b+=";"),b+=d+":"+a.style[d],a.elem.style[d]=a.style[d]);a.elem.setAttribute("style",b)}a.elem.className=a.className?a.className:""},control:function(a){switch(a.state){case "raised_lead":CornerWidgetUI._manage_styles({elem:CornerWidgetUI.elem_widget_btn,
reset:[CornerWidgetUI._ui_config.position["vertical-align"],CornerWidgetUI._ui_config.position.align],className:"a-gorilla-aboutToWait"});CornerWidgetUI._manage_styles({elem:CornerWidgetUI.elem_widget_box,reset:"height"});CornerWidgetUI._manage_styles({elem:CornerWidgetUI.elem_widget_bar});CornerWidgetUI._declare_bar_length();CornerWidgetUI.elem_sendlead_btn.innerHTML="Waiting for callback";setTimeout(function(){CornerWidgetUI.elem_widget_btn.className="a-gorilla-waiting"},1100);"raised_lead"!=CornerWidgetUI._prev_state&&
(CornerWidgetUI.elem_field_name.disabled=!0,CornerWidgetUI.elem_field_tel.disabled=!0,CornerWidgetUI.elem_field_service.disabled=!0,CornerWidgetUI.elem_sendlead_btn.disabled=!0,$lucep.send_intelligence({event_type:"raised-lead",payload:{country:window.jQuery(".selected-flag").attr("title")}}));CornerWidgetUI._prev_state=CornerWidgetUI._curr_state;CornerWidgetUI._curr_state="raised_lead";break;case "auto_open":case "tapped_icon":case "clicked_icon":"a-gorilla-clicked"==CornerWidgetUI.elem_widget_btn.className&&
"auto_open"!=a.state?(CornerWidgetUI._manage_styles({elem:CornerWidgetUI.elem_widget_btn,reset:[CornerWidgetUI._ui_config.position["vertical-align"],CornerWidgetUI._ui_config.position.align]}),CornerWidgetUI._manage_styles({elem:CornerWidgetUI.elem_widget_box,reset:["height"]}),CornerWidgetUI._manage_styles({elem:CornerWidgetUI.elem_widget_bar,reset:[CornerWidgetUI._ui_config.position["vertical-align"],CornerWidgetUI._ui_config.position.align]}),CornerWidgetUI._declare_bar_length(),"new"==CornerWidgetUI._prev_state||
"closed"==CornerWidgetUI._prev_state||"open"==CornerWidgetUI._prev_state?(CornerWidgetUI.elem_widget_btn.className="",CornerWidgetUI.elem_widget_box.className="",CornerWidgetUI.elem_widget_bar.className="",CornerWidgetUI._prev_state=CornerWidgetUI._curr_state,CornerWidgetUI._curr_state="closed"):"in_call"==CornerWidgetUI._prev_state?(CornerWidgetUI.elem_widget_btn.className="a-gorilla-incall",CornerWidgetUI.elem_widget_box.className="",CornerWidgetUI.elem_widget_bar.className="",CornerWidgetUI._prev_state=
CornerWidgetUI._curr_state,CornerWidgetUI._curr_state="in_call"):"raised_lead"==CornerWidgetUI._prev_state&&(CornerWidgetUI.elem_widget_btn.className="a-gorilla-aboutToWait",CornerWidgetUI.elem_widget_box.className="",CornerWidgetUI.elem_widget_bar.className="",CornerWidgetUI.elem_sendlead_btn.innerHTML="Waiting for callback",setTimeout(function(){CornerWidgetUI.elem_widget_btn.className="a-gorilla-waiting"},1100),CornerWidgetUI._prev_state=CornerWidgetUI._curr_state,CornerWidgetUI._curr_state="raised_lead"),
$lucep.send_intelligence({event_type:"close-prompt",payload:{location:window.jQuery(".selected-flag").attr("title")}}),$lucep.put_data({key:"lucep-state",value:"closed"})):"a-gorilla-clicked"!=CornerWidgetUI.elem_widget_btn.className&&(CornerWidgetUI._manage_styles({elem:CornerWidgetUI.elem_widget_btn,style:CornerWidgetUI._dyn_obj([{key:CornerWidgetUI._ui_config.position["vertical-align"],value:CornerWidgetUI.elem_formdata.clientHeight+13+20+"px"},{key:CornerWidgetUI._ui_config.position.align,value:CornerWidgetUI.elem_formdata.clientWidth+
20+"px"}]),className:"a-gorilla-clicked"}),CornerWidgetUI._manage_styles({elem:CornerWidgetUI.elem_widget_box,style:{height:CornerWidgetUI.elem_formdata.clientHeight+13+"px",width:CornerWidgetUI.elem_formdata.clientWidth+"px"},className:"a-gorilla-open"}),CornerWidgetUI._manage_styles({elem:CornerWidgetUI.elem_widget_bar,style:CornerWidgetUI._dyn_obj([{key:CornerWidgetUI._ui_config.position["vertical-align"],value:CornerWidgetUI.elem_formdata.clientHeight+13+20+10+"px"},{key:CornerWidgetUI._ui_config.position.align,
value:CornerWidgetUI.elem_formdata.clientWidth+20+20+"px"}]),className:"a-gorilla-open"}),setTimeout(function(){CornerWidgetUI.elem_widget_box.style.overflow="visible"},1E3),$lucep.send_intelligence({event_type:a.state,payload:{location:window.jQuery(".selected-flag").attr("title")}}),CornerWidgetUI._prev_state=CornerWidgetUI._curr_state,CornerWidgetUI._curr_state="open",$lucep.put_data({key:"lucep-state",value:"open"}));break;case "in_call":"in_call"!=CornerWidgetUI._curr_state&&"open"!=CornerWidgetUI._curr_state?
(CornerWidgetUI.elem_widget_btn.className="a-gorilla-aboutToWait",setTimeout(function(){CornerWidgetUI.elem_widget_btn.className="a-gorilla-incall"},500),CornerWidgetUI._prev_state=CornerWidgetUI._curr_state,CornerWidgetUI._curr_state=a.state):CornerWidgetUI._prev_state="in_call";CornerWidgetUI.elem_field_name.disabled=!0;CornerWidgetUI.elem_field_tel.disabled=!0;CornerWidgetUI.elem_field_service.disabled=!0;CornerWidgetUI.elem_sendlead_btn.disabled=!0;CornerWidgetUI.elem_sendlead_btn.innerHTML="Currently in call";
break;case "new":"undefined"==typeof CornerWidgetUI._prev_state||null==CornerWidgetUI._prev_state?(CornerWidgetUI._within_session(!0)?(CornerWidgetUI.elem_widget_btn.className="",CornerWidgetUI.elem_widget_box.className="",CornerWidgetUI.elem_widget_bar.className="",CornerWidgetUI._declare_bar_length()):setTimeout(function(){CornerWidgetUI.elem_widget_btn.className="";CornerWidgetUI.elem_widget_box.className="";CornerWidgetUI._declare_bar_length();CornerWidgetUI.elem_pulse.className="emit";setTimeout(function(){CornerWidgetUI.elem_pulse.className=
""},2100)},1E3),CornerWidgetUI._prev_state=a.state,CornerWidgetUI._curr_state=a.state,0<CornerWidgetUI._ui_config.auto_open&&(!$lucep.get_data({key:"lucep-state"})||"open"==$lucep.get_data({key:"lucep-state"}))&&setTimeout(function(){window.intlTelInputUtils||jQuery("#"+CornerWidgetUI.constants._uivar_leadtelID).intlTelInput("loadUtils",CornerWidgetUI._ui_config.tel_input_prefs.utilsScript);CornerWidgetUI.control({state:"auto_open"})},CornerWidgetUI._ui_config.auto_open)):(CornerWidgetUI._curr_state=
a.state,CornerWidgetUI._manage_styles({elem:CornerWidgetUI.elem_widget_btn,reset:[CornerWidgetUI._ui_config.position["vertical-align"],CornerWidgetUI._ui_config.position.align]}),CornerWidgetUI._manage_styles({elem:CornerWidgetUI.elem_widget_box,reset:["height","overflow","width"]}),CornerWidgetUI._manage_styles({elem:CornerWidgetUI.elem_widget_bar,reset:[CornerWidgetUI._ui_config.position["vertical-align"],CornerWidgetUI._ui_config.position.align]}),CornerWidgetUI._declare_bar_length()),CornerWidgetUI.elem_field_name.disabled=
!1,CornerWidgetUI.elem_field_tel.disabled=!1,CornerWidgetUI.elem_field_service.disabled=!1,CornerWidgetUI.elem_sendlead_btn.disabled=!1,CornerWidgetUI.elem_sendlead_btn.innerHTML=CornerWidgetUI._ui_config.button_cta[CornerWidgetUI._ui_config.default_lang]}a.event&&(a.event.stopPropagation?a.event.stopPropagation():a.event.cancelBubble=!0)},_raise_lead:function(a){if(!0===CornerWidgetUI._block||""!=document.getElementById(CornerWidgetUI.constants._uivar_controlfield1).value||document.getElementById(CornerWidgetUI.constants._uivar_controlfield2).value!=
CornerWidgetUI.constants._formval_placeholder2)return CornerWidgetUI._b={},setTimeout(function(a){for(a=0;1E5>a;a++)CornerWidgetUI._b[a]=new Date},1E3),a.disabled=!0;if(!jQuery("#"+CornerWidgetUI.constants._uivar_leadtelID).intlTelInput("isValidNumber")&&CornerWidgetUI._ui_config.validation.count<CornerWidgetUI._ui_config.validation.limit)return jQuery("#"+CornerWidgetUI.constants._uivar_leadtelID).addClass("a-gorilla-error"),setTimeout(function(){jQuery("#"+CornerWidgetUI.constants._uivar_leadtelID).removeClass("a-gorilla-error")},
1E3),CornerWidgetUI._ui_config.validation.count++,!1;CornerWidgetUI._ui_config.validation.count=0;var b;if(window.intlTelInputUtils&&""!==window.jQuery("#"+CornerWidgetUI.constants._uivar_leadtelID).intlTelInput("getNumber"))b=window.jQuery("#"+CornerWidgetUI.constants._uivar_leadtelID).intlTelInput("getNumber");else{b=window.jQuery(".selected-flag").attr("title");b=b.substr(b.indexOf(": +")+2,5);var c=window.jQuery("#"+CornerWidgetUI.constants._uivar_leadtelID).val();b=0===c.indexOf(b)?c:b+""+c}$lucep.put_data({key:"name",
value:document.getElementById(CornerWidgetUI.constants._uivar_leadnameID).value});$lucep.put_data({key:"tel",value:b});$lucep.raise_lead({payload:{},service_id:document.getElementById(CornerWidgetUI.constants._uivar_leadserviceID).value,service_name:window.jQuery("#gorillaFormService option:selected").text(),phone_number:b,name:document.getElementById(CornerWidgetUI.constants._uivar_leadnameID).value,callback:function(a){if(a["ticket-status"]||!0!==a.server)switch(a["ticket-status"]){case "new":return CornerWidgetUI.control({state:"raised_lead"}),
!0;case "processing":return CornerWidgetUI.control({state:"in_call"}),!0;case "finished":return CornerWidgetUI.control({state:"new"}),!1;case "no-ticket":return CornerWidgetUI.control({state:"new"}),!1}else CornerWidgetUI.control({state:"new"})}});a.disabled=!0;CornerWidgetUI.elem_field_name.disabled=!0;CornerWidgetUI.elem_field_tel.disabled=!0;CornerWidgetUI.elem_field_service.disabled=!0;a.innerHTML="<img src='https://8d69a4badb4c0e3cd487-efd95a2de0a33cb5b6fcd4ec94d1740c.ssl.cf2.rackcdn.com/images/small-spinner.gif' alt='Please wait' />"}};
window.$lucep_ui=CornerWidgetUI;
